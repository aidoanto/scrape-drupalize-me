---
title: "JSON:API Error Handling"
url: "https://drupalize.me/tutorial/jsonapi-error-handling?p=3277"
guide: "[[decoupled-headless-drupal]]"
---

# JSON:API Error Handling

## Content

Sometimes unexpected things happen and Drupal needs to generate an error. The JSON:API specification describes how the server should return those errors. Understanding what to expect allows consumers to plan for errors and react gracefully.

In this tutorial we will:

- Discuss how HTTP errors are used in conjunction with JSON:API
- Learn about how JSON:API embeds information about the error encountered into the response object

By the end of this tutorial, you should have a basic understanding of the types of errors you can expect to receive when making JSON:API requests and what you can do to handle them.

## Goal

After this tutorial we will understand what the HTTP error codes mean. We will also learn about the structure of the document when an error happens so our consumers can react appropriately to them.

## Prerequisites

- [Install JSON:API Module](https://drupalize.me/tutorial/install-jsonapi-module)

## Plan to handle HTTP errors

Even if we devote a lot of care to the quality of our code, there will always be unexpected errors we will have to plan for. That is why the HTTP protocol defines a wide set of error codes, which anticipate most of the things that can go wrong when making HTTP requests.

The most famous of all is the *404 Not Found* code. This error means that whatever the user requested could not be found. In fact, all the error codes in the 4XX range speak of errors that happened due to something the user did. On the other hand, the 5XX errors are about problems that the server had while trying to deliver a response. The [complete list of status codes](https://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml) covers many of the specific errors that can happen. For instance *429 Too Many Requests* is for abuses of the service, while *507 Insufficient Storage* is for when the disk in the host's server is full.

JSON:API responds with the appropriate error codes whenever necessary. This way, consumers can react to each particular problem. For instance, an Angular application could detect that a response has a status code of *401 Unauthorized* and redirect the user to the login form. It could also show a message about validation errors when the server returns a *406 Not Acceptable*.

## Error handling according to JSON:API

On top of the semantic status codes, the JSON:API specification [has an opinionated way](http://jsonapi.org/format/#error-objects) to provide more information about the error. In particular it says:

> Error objects provide additional information about problems encountered while performing an operation. Error objects **MUST** be returned as an array keyed by errors in the top level of a JSON:API document.

Since the JSON:API module for Drupal is fully compliant with the specification, it returns the errors in this format.

Imagine that a consumer wants to create an entity and therefore it makes a POST request. Now imagine that the data provided by the user fails validation in the server. In that eventuality the JSON:API module will respond with a collection of errors. Each one of those will contain a `source.pointer` indicating what properties failed validation, and a human description of what went wrong. Now the Angular app can highlight in red the form elements that control the properties that failed validation. This shows that if we have an standard way to return errors, the consumer can take advantage of it in order to improve the user experience.

The JSON:API module can return the whole stack trace about the error. It does that when the authenticated user in the request has access to the site reports. That means that we can get detailed information about what went wrong on the Drupal site if we authenticate the request with a user that can see the site reports. This feature will give us more insight about where the error originated, so we can implement the best error handler for it.

To finish, it's worth noting that 403 errors and 404 errors in JSON:API will only be nicely formatted if we provide the expected—but optional—`Accept: application/vnd.api+json` header. The technical reason for that is in [the module's issue queue](https://www.drupal.org/project/jsonapi/issues/2831137).

## Example response

Here's an example of a response that contains an error generated by attempting to request a resource that the current user does not have access to. Note both HTTP 403 error code, and the `errors` object in the JSON response.

```
HTTP/1.1 403 Forbidden
Cache-Control: must-revalidate, no-cache, private
Connection: keep-alive
Content-Type: application/vnd.api+json
Content-language: en
Date: Wed, 20 Dec 2017 15:40:35 GMT
Expires: Sun, 19 Nov 1978 05:00:00 GMT
Server: nginx/1.9.12
Transfer-Encoding: chunked
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-Generator: Drupal 8 (https://www.drupal.org)
X-UA-Compatible: IE=edge

{
    "errors": [
        {
            "code": "0",
            "detail": "The current user is not allowed to GET the selected resource. The 'access user profiles' permission is required and the user must be active.",
            "id": "/user--user/5bcc7ae7-35c3-4ac7-9bc9-b442c0972d80",
            "links": {
                "info": "http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.4"
            },
            "source": {
                "pointer": "/data"
            },
            "status": "403",
            "title": "Forbidden"
        }
    ]
}
```

## Recap

Understanding how a request may fail and what the resulting response will look like is an important part of handling errors gracefully. It is the best way to ensure that we can respond appropriately to the user when an error happens.

The JSON:API module for Drupal will:

- Respect the the generic HTTP status codes
- Implement the [JSON:API specification about errors](http://jsonapi.org/format/#error-objects)
- Add extra information with the error's stack trace if the user has enough privileges

## Further your understanding

- Which of the [HTTP error codes](http://jsonapi.org/format/#error-objects) do you think you're likely to encounter in a decoupled application?
- Different errors can have different implications on the cache. Should a 404 error be cached? Should a 503 error be cached? Is there any difference in cacheability if the error is on the server side or on the user side?

## Additional resources

- [Hypertext Transfer Protocol (HTTP) Status Code Registry](https://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml) (iana.org)
- [JSON:API error objects specification](https://jsonapi.org/format/#error-objects) (jsonapi.org)
- Resolved issue: [Remove the need for ?\_format=api\_json: assume the use of the 'api\_json' format for routes managed by JSON API](https://www.drupal.org/project/jsonapi/issues/2831137) (Drupal.org)

Was this helpful?

Yes

No

Any additional feedback?

Previous
[JSON:API Filters on Nested Relationships](/tutorial/jsonapi-filters-nested-relationships?p=3277)

Next
[JSON:API Security Considerations](/tutorial/jsonapi-security-considerations?p=3277)

Clear History

Ask Drupalize.Me AI

close