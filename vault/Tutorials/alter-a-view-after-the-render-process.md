---
title: "Alter a View after the Render Process"
url: "https://drupalize.me/tutorial/alter-view-after-render-process?p=2939"
guide: "[[views-drupal]]"
---

# Alter a View after the Render Process

## Content

Using `hook_views_post_render()` Drupal module developers can change the render array representation of a View before it gets displayed. You can use this to modify the computed HTML of a view just before it gets printed. This hook is similar to using a preprocess function for a template file, but in this case you have access to the whole render tree, not just the specific leaf covered by the template file you're preprocessing.

This hooks gets called after the Views object has been through the render process, and all the different configured displays and formatters have been applied, producing a render array representation of the results of the view. This hook receives an `$output` parameter which contains the render array, and only changes made directly to the `$ouput` variable will have any effect. This hook is the last chance to make changes to the render array before it is converted to markup.

You can use `hook_views_post_render()` to change `#cache` properties for the View, and to do things like add CSS classes to rows, and change the page title.

In this tutorial we'll:

- Learn how to alter a view's rendered output right after the Views object completes the render phase of the build cycle.
- Use `hook_views_post_render()` to change the title of the view's display

By the end of this tutorial you should know how to alter the render array generated by a View prior to it being passed to the theme layer and converted to HTML.

## Goal

Use `hook_views_post_render()` to programmatically alter the title of the Views display to append today's date to the *News* list.

## Prerequisites

- [Overview: Build and Render Cycles in Views](https://drupalize.me/tutorial/overview-build-and-render-cycles-views)
- [What Are Render Arrays?](https://drupalize.me/tutorial/what-are-render-arrays)

## Where are we now?

The distinction between the pre-render and post-render phases of the Views build cycle might be a little confusing. Differentiating between them can help you decide when to use `hook_views_pre_render()` versus `hook_views_post_render()`. Looking at the code in `\Drupal\views\ViewExecutable::render` where both of these hooks are invoked can help explain it.

When `hook_views_pre_render()` is invoked the `ViewExecutable` object is completely loaded, contains all the results, and is fully *processed*. The `$this->display_handler->output` is currently set to `FALSE`.

After the pre-render phase, the `render()` methods of all display handlers are called. This results in `$this->display_handler->output` being populated with a render array. Something like the following:

Image

![Example render array content](/sites/default/files/styles/max_800w/public/tutorials/images/views-display-handler-output.png?itok=GiFgnGb8)

Then, `hook_views_post_render()` implementations are invoked. The `&$output` variable passed to those functions is a reference to `$this->display_handler->output`. These functions can make any modifications to the render array's content.

Finally, `\Drupal\views\ViewExecutable::render` returns the `$this->display_handler->output` array.

**Note:** If any fields contain field rewrite configuration, those rewrites are not done yet. If you are looking to work with the rendered HTML markup, it's recommended to use standard Drupal Render API preprocess functions or Twig template files.

## Make changes to the rendered output of a View

### Create and enable a custom module

We're going to work within a custom module named `news`. If you are looking for more information about custom modules in Drupal, refer to our [module development guide](https://drupalize.me/guide/develop-drupal-sites).

To follow along, create a custom module, call it `news`, and add *news.info.yml* and *news.module* files. Place it in the */modules/custom* directory of your site. Then enable it either with Drush (`drush en news -y`) or using the administrative UI *Extend* page.

### Build a view

Using the Views UI, build a View named "News" that displays a list of *Article* nodes using a block display of *teasers* in an *Unformatted list* limited to 5 items. [Place the resulting block on a page](https://drupalize.me/tutorial/user-guide/block-place?p=3068) so that it's visible.

Your view should look something like the screenshot below.

Image

![Screenshot of news view block](/sites/default/files/styles/max_800w/public/tutorials/images/news_view.png?itok=Ksrtcjpt)

And the configuration may look something like the following:

Image

![Screenshot of news view block](/sites/default/files/styles/max_800w/public/tutorials/images/news_view_config.png?itok=7X7Iy6BX)

If you'd like to learn more about how to work with Views through the UI, refer to [Display content with views tutorial](https://drupalize.me/topic/display-content-views).

### Implement `hook_views_post_render()`

In the *news.module* file for your module, define an implementation of `hook_views_pre_render()`.

This hook takes three parameters: a Views executable object, a render array, and a cache object.

The content of your hook should look something like the following:

```
use Drupal\views\ViewExecutable;
use Drupal\views\Plugin\views\cache\CachePluginBase;
use Drupal\Core\Datetime\DrupalDateTime;

/**
 * Implements hook_views_post_render().
 */
function news_views_post_render(ViewExecutable $view, &$output, CachePluginBase $cache) {
  if ($view->id() == 'news') {
    $date = new DrupalDateTime();
    $date = $date->format('j F, Y');
    $title = $view->getTitle();
    $view->setTitle($title . ' - ' . $date);

    // Example that modifies the $output array.
    if (\Drupal::currentUser()->isAuthenticated()) {
      $output['#theme'][] = 'views_view__news__authenticated';
    }
  }
}
```

In this function we are checking for the correct `id` (in our case it's `news`), obtaining the current date using the `DrupalDateTime` class, formatting it into a human-readable string, and then using methods of the `ViewExecutable` object to get and update the title of the Views display. If your view has more than one display, it might be a good idea to add an additional check for the current display.

The View's `id` is the machine name of the View and can be found on the Views administration page: *Structure* > *Views* (*admin/structure/views*).

[Clear the cache](https://drupalize.me/tutorial/clear-drupals-cache) and reload the page to see the updated View. Your news view block should now have a new title with the current date appended to it.

You may see something like the following screenshot.

Image

![Screenshot of the new news title](/sites/default/files/styles/max_800w/public/tutorials/images/news_title.png?itok=z685EYvW)

This hook is also a good place to alter Views cache or make alterations to the `$output` render array.

## Recap

In this tutorial, we learned how to use Views `hook_views_post_render()` to alter the render array, and other rendered output, generated by Views. We also learned about the difference in the state of the Views object between `hook_views_pre_render()` and `hook_views_post_render()` implementations.

## Further your understanding

- Can you think of other use cases for `hook_views_post_render()`?
- Many use cases could apply either `hook_views_pre_render()` or `hook_views_post_render()` equally well. Can you think of any examples where that is specifically not true?

## Additional resources

- [List of views hooks](https://api.drupal.org/api/drupal/core%21modules%21views%21views.api.php/11.x) (api.drupal.org)

Was this helpful?

Yes

No

Any additional feedback?

Previous
[Alter a View before It's Rendered](/tutorial/alter-view-its-rendered?p=2939)

Next
[Alter the Query Used for a View](/tutorial/alter-query-used-view?p=2939)

Clear History

Ask Drupalize.Me AI

close