---
title: "Create a Facet using Taxonomy"
url: "https://drupalize.me/tutorial/create-facet-using-taxonomy?p=2815"
guide: "[[drupal-site-administration]]"
---

# Create a Facet using Taxonomy

## Content

A powerful facet combination is to create a search Facet on a taxonomy field. This brings several advantages to how your search can be configured and displayed.

In this tutorial, we'll:

- Describe the additional complexities for using a reference field for a facet
- Show how to use taxonomy weights to control facet option order

By the end of this tutorial you should be able to add a facet that allows users to filter search result based on taxonomy terms.

## Goal

Create a Facet on a complex field such as a taxonomy reference field.

## Prerequisites

- [Create a Facet](https://drupalize.me/tutorial/create-facet)

## Text list vs. tag fields

The two types of fields most commonly used for creating facets are text list fields and taxonomy term reference fields.

Text list (sometimes called "list item" fields) work like regular plain-text fields in the database. The key difference is that in the UI, they may only be set to a limited number of values. This makes text list fields excellent for use in facets.

The big downside of text list fields is that the list of options available cannot be easily changed. The only way to add a new field value is to either remove use of the field from all content or write custom code to perform the update.

Taxonomy reference fields, on the other hand, do not have this limitation. New tags can be added to the vocabulary at any time. Content creators can even create their own tags as needed without further administrative approval. The downside, however, is that they require additional setup and consideration prior to implementation.

## Create a term reference facet

Creating a term reference facet is very similar to creating a facet based on text list fields.

### Create the vocabulary and initial terms

First, create the necessary taxonomy vocabulary to house the terms. If your taxonomy already exists, skip this step.

1. Login to your Drupal site with administrator privileges.
2. Using the *Manage* administrative menu, navigate to *Structure* > *Taxonomy* (*admin/structure/taxonomy*).
3. Click *Add vocabulary*.
4. Enter a vocabulary *Name*.
5. Configure remaining options as necessary. When finished click *Save*.
6. Use the *Add term* button to create additional terms as necessary.

### Create the term reference field

Next, we can create the term reference field and add it to our target content types. Again, if your field already exists, skip this step. This tutorial will create a new vocabulary named *Topics*.

1. Using the *Manage* administrative menu, navigate to *Structure* > *Content types* (*admin/structure/types*).
2. Open the target content type for editing.
3. In the *Manage fields* tab, click *Add field*.
4. Using the *Add new field* dropdown, select *Taxonomy term*.
5. Enter a *Label* of your choosing.
6. Click *Save*.
7. Set the *Allowed number of values* appropriate for your field.
8. Click *Save field settings*.
9. Under the *Reference type* section, select the *Vocabulary* you created earlier.
10. If you want to allow content creators to create their own terms, select *Create referenced entities if they don't already exist*.
11. Click *Save settings*.

### Update content

If this is a new term reference field, take some time to update existing content to leverage the new field. If you are using autogenerated content from the Devel module, consider generating additional content so the field is used.

### Add the field to the Search API index

1. Using the *Manage* administrative menu, navigate to *Configuration* > *Search and Metadata* > *Search API*.
2. Locate the index you created earlier and open it for editing.
3. Open the *Fields* tab.
4. Click *Add fields*.
5. The *Add fields to index...* modal dialog appears. Scroll through the list, locating the target taxonomy field.
6. Click the *Add* button next to the field. Do not expand the field or select a component.
7. Notice that a new field appears in the *Content* table. Ensure that the *Type* is *integer* rather than *string*.
8. Click *Save changes*.

### Rebuild the search index

Rebuild the search index so that Solr is made aware of the new field:

```
drush sapi-c
drush sapi-i
```

Learn more about reindexing, and how to do it via the UI, in [Populate Search API Indexes](https://drupalize.me/tutorial/populate-search-api-indexes).

### Update the Search API view

For Facets to use the new term field, we need to add it to our Search API-powered view. While you can display the field in your search results, it is common practice to hide fields used in facets to prevent the page from being too noisy.

1. Open your search view for editing.
2. Under *Fields*, click *Add*.
3. The *Add fields* modal dialog appears. Select your field from the list. Be sure that it is shown as *(indexed field)* so the field value is pulled from Solr.
4. Click *Add and configure fields*.
5. Select *Exclude from display* to hide the display from the search results.
6. Click *Apply*.
7. *Save* the view.

### Create the facet

1. Using the *Manage* administrative menu, navigate to *Configuration* > *Search and Metadata* > *Facets* (*admin/config/search/facets*).
2. Click *Add facet*.
3. Select your view as the *Facet source*.
4. Select the *Field* you just created. If it does not appear, go back and update the view.
5. Enter a *Name* of your choice.
6. Click *Save*.
7. Select the *Widget* for the facet display. This tutorial uses *List of links*.
8. If desired, select *Show the amount of results*.
9. Click *Save*.

### Show term labels

By default, a facet on any reference field will only display the referenced entity IDs. Needless to say, this is less than useful for our needs. Ideally, we want to show the taxonomy term label instead. Fortunately, Facets handles this easily.

1. Using the *Manage* administrative menu, navigate to *Configuration* > *Search and metadata* > *Facets* (*admin/config/search/facets*).
2. Open your facet for editing.
3. Select *Transform entity ID to label*.
4. Click *Save*.

### Sort by term weight

A notable advantage of creating a facet on a taxonomy term instead of a text list field is that each term within the vocabulary has a *weight*. This allows you to configure the order in which items appear when selecting terms while creating content, but it can also be leveraged by the facet. This allows you to change the display order of facet options as needed.

1. Using the *Manage* administrative menu, navigate to *Configuration* > *Search and metadata* > *Facets* (*admin/config/search/facets*).
2. Open your facet for editing.
3. Scroll down to the *Facet sorting* section at the bottom of the page.
4. Select *Sort by taxonomy term weight*.
5. Select the *Sort order*.
6. Click *Save*.

### Place the facets block

Finally, to use our new facet we need to use the Block UI to place the facets block.

1. Using the *Manage* administrative menu, navigate to *Structure* > *Block layout* (*admin/structure/block*).
2. Use a *Place block* button to place the block in a target region. While this can be anywhere, typical placement for facet blocks is either above the *Content* or in a sidebar region.
3. The *Place block* modal dialog appears. Scroll through the list and locate the block for your facet. If you are having difficulty finding it, look for any items with the *Category* of *Facets*.
4. Click *Place block*.
5. Under *Visibility*, open the *Pages* vertical tab. Configure the facet block to only appear on the page provided by your search view.
6. Click *Save block*.
7. Click *Save blocks*.

### Validate the configuration

1. Navigate to the page provided by your search view.
2. Perform a search. If you are using autogenerated content from the Devel module, take special care in selecting the search term.
3. Note that your facet block now appears on the page, and the values shown correspond to what is in existing search results.

   Image

   ![A screenshot showing the new Topics facet block with term labels](/sites/default/files/styles/max_800w/public/tutorials/images/termFacet.png?itok=JNBvwrzq)
4. Use the facet to perform a drill-down search.

## Limitations of content-type-based facets

Many developers try to create facets based on the content type. Since each content type can have different fields, they are often created to cater to different kinds of content. A `blog post` content type will have different fields compared to a `video tutorial` content type. As a result, it seems natural to create a facet to allow end users to narrow their results based on that differentiation.

Search API is certainly capable of supporting this configuration. Add the content type's field to the Search API index, then the Search API-powered view, and then finally create the facet. Depending on your needs, you can display the machine name of the content type, or the label.

This configuration, however, is not as flexible as it appears. Often, content types can become functionally grouped over time. Content with the `blog post` type and `video tutorial` type may be thought of as belonging to the site's knowledge center. Compare this to a content type such as `press release` which would be better categorized elsewhere. A particular content type may also belong to multiple sections of the site. Furthermore, a custom facet option order may be required. Yet, content types don't come with an easy mechanism to change their order.

## Use a taxonomy term field instead of content type

An alternative to content-type-based facets is to use a taxonomy term field instead. Here's how that configuration could work.

### Create the vocabulary and terms for each "site section"

Add a term field to each content type.

For each content type, configure the field with one or more default values.

If desired, hide the field from use in the form display.

Add the field to the Search API index, view, and create the facet.

Use custom code or *Views Bulk Operations* to assign the site sections.

This taxonomy-term-based facets configuration allows you to create a much more flexible "content section" facet without limiting yourself to content type names alone.

## Recap

Creating a facet based on a taxonomy term has several advantages. The number of options available is open-ended. Administrators and even content creators can add new facet options by creating an additional term. Facets based on term fields will only display the referenced entity ID unless the *Transform entity ID to label* option is selected in the facet. Lastly, facets based on terms can take advantage of the term's weight for easily customizable sorting.

## Further your understanding

- Under what circumstances would you use a taxonomy with a hierarchy for a facet?

## Additional resources

- [Taxonomy (topic)](https://drupalize.me/topic/taxonomy) (Drupalize.Me)
- [Devel](https://drupalize.me/topic/devel) (Drupalize.Me)

Was this helpful?

Yes

No

Any additional feedback?

Previous
[Create a Facet](/tutorial/create-facet?p=2815)

Clear History

Ask Drupalize.Me AI

close